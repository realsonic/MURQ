# Заметки к выпускам MURQ.Console 0.6.x

**MURQ.Console** - консольное приложение для проигрывания URQ-файлов (квестов), написанных на URQL.  

## Цель выпуска
Установка цвета текста и фона локаций.

## Параметры запуска
| № | Параметр     | Значение            | Обязательность   | Описание
| -:| ------------ | ------------------- |:----------------:| --------
| 1 | `<qst-файл>` | путь к файлу квеста | **Обязательный** | Если параметр не задан, приложение выдаёт ошибку и останавливает работу.
| 2 | `--encoding <кодировка>` <hr/> `-enc <кодировка>` | `utf8` <hr/> `win` <hr/> `dos` | нет | Кодировка файла квеста. Если кодировка не задана, то она определятся автоматически (см. в фичах ниже).

## Возможности (фичи)
- Запуск простейших URQ-квестов.
- Выбор варианта действий (кнопки) через ввод цифры (возможен выбор вариантов `1`-`9`, `a`-`z`).
- Перезагрузка квеста комбинацией `Ctrl`+`R` (или `r`/`R` в режиме перенаправленного ввода).
- Выход из приложения комбинацией `Ctrl`+`Q` (или `q`/`Q` или конец ввода в режиме перенаправленного ввода).
- Если кодировка файла квеста не задана в параметрах, она определяется автоматически: UTF-кодировки определяются успешно, если они идут с маркером вначале файла (BE/LE BOM), иначе кодировкой считается `Windows-1251`.

### Поддерживаемый URQL
#### Команды
| Команда                            | Пример              | Заметка
| ---------------------------------- | ------------------- | -----------
| **Метка**                          | `:метка`            | Названием метки считается текст без начальных и конечных пробелов и табуляции.
| **Вывод текста**                   | `pln Привет, #имя_рек$!` | Допускаются `p` и `pln`. Поддерживаются простые подстановки (имя переменной: `#a$`).
| **Кнопка**                         | `btn 1,В начало`    | Между `btn` и меткой допускается пробел или табуляция. Метка берётся без начальных и конечных пробелов и табуляции.
| **Конец локации**                  | `end`
| **Присвоение значения переменной** | `a=4` <hr/> `b="привет"` <hr/> `c=a` | Поддерживаются числовые и строковые литералы и переменные.
| **Условие**                        | `if a=4 then pln Всего хорошего!` | _Пока поддерживаются только выражения проверки на равенство переменных, чисел или строк, а также только одна команда для выполнения._
| **Безусловный переход**            | `goto метка`        | Между `goto` и меткой допускается пробел или табуляция. Метка берётся без начальных и конечных пробелов и табуляции.
| **Очистка экрана**                 | `cls`               | **Не работает в режиме перенаправленного вывода.** _Пока не учитывает никаких настроек через переменные._
| **Удаление переменных**            | `perkill`
| **Пауза**                          | `pause 500`         | _Непрерываемая (кнопками) пауза._

#### Прочее
| Элемент                            | Пример              | Заметка
| ---------------------------------- | ------------------- | -----------
| **Однострочный комментарий**       | `; Комментарий`     | Допускается в любой строке. Вырезается до загрузки квеста.
| **Многострочный комментарий**      | `/* Комментарий */` | Допускается в любом месте. Вырезается до загрузки квеста.

### Системные переменные
| Переменная     | Пример         | Заметка
| -------------- | -------------- | -----------
| `current_loc`  | `current_loc`  | Текущая локация (последняя метка, на которую перешли по кнопке).
| `previous_loc` | `previous_loc` | Предыдущая локация (метка, на которую перешли по кнопке в предыдущий раз).
| `rnd`[число]   | `rnd6`         | Возвращает случайное число. Если указано число - то целое число от 1 до указанного числа, иначе - дробное число от 0 до 1 не включая.
| `style_dos_textcolor` | `style_dos_textcolor = 202`   | Устанавливает цвет текста и фона локаций. Значение – восьмибитное целое число, младшие 4 бита которого отвечают за цвет, а старшие 4 – за фон. По умолчанию = 7. При выход за диапазон 0-255 считается равным 128. Присвоения строк игнорируются.
| `style_dos_buttoncolor` | `style_dos_buttoncolor = 202`   | Устанавливает цвет текста и фона кнопок. Значение – восьмибитное целое число, младшие 4 бита которого отвечают за цвет, а старшие 4 – за фон. По умолчанию = 15. При выход за диапазон 0-255 считается равным 128. Присвоения строк игнорируются.

### Ограничения
- Подстановки `#$` пока поддерживаются только простые (имя переменной: `#a$` или `#%a$`) внутри `p`/`pln`.
- `Common`-локации пока не поддерживаются.