# Заметки к выпускам MURQ.Console 0.5.x

**MURQ.Console** - консольное приложение для проигрывания URQ-файлов (квестов), написанных на URQL.  

## Цель выпуска
Поддержка простых подстановок в `p`/`pln`, `goto`, `rnd[число]`, `perkill` и загрузка файла квеста в разных кодировках.

## Параметры запуска
| № | Параметр | Значение | Обязательность | Описание |
| -:| -------- | -------- |:--------------:| -------- |
| 1 | `<qst-файл>` | путь к файлу квеста | **Обязательный** | Если параметр не задан, приложение выдаёт ошибку и останавливает работу.
| 2 | `--encoding <кодировка>` или `-enc <кодировка>` | `utf8` или `win` или `dos` | нет | Кодировка файла квеста. Если кодировка не задана, то она определятся автоматически (см. в фичах ниже).

## Возможности (фичи)
- Запуск простейших URQ-квестов.
- Выбор варианта действий (кнопки) через ввод цифры (возможен выбор только вариантов `1`-`9`).
- Перезагрузка квеста комбинацией `Ctrl`+`R` (или `r`/`R` в режиме перенаправленного ввода).
- Выход из приложения комбинацией `Ctrl`+`Q` (или `q`/`Q` или конец ввода в режиме перенаправленного ввода).
- Кодировка файла квеста определяется автоматически: UTF-кодировки определяются успешно, если они идут с маркером вначале файла (BE/LE BOM), иначе кодировкой считается `Windows-1251`.

### Поддерживаемый URQL
#### Команды
| Команда                            | Пример              | Заметка
| ---------------------------------- | ------------------- | -----------
| **Метка**                          | `:метка`            | Названием метки считается текст без начальных и конечных пробелов и табуляции.
| **Вывод текста**                   | `pln Привет, #имя_рек$!` | Допускаются `p` и `pln`. Поддерживаются простые подстановки (имя переменной: `#a$`).
| **Кнопка**                         | `btn 1,В начало`    | Между `btn` и меткой допускается пробел или табуляция. Метка берётся без начальных и конечных пробелов и табуляции.
| **Конец локации**                  | `end`
| **Присвоение значения переменной** | `a=4`               | _Пока поддерживаются только целые числа._
| **Условие**                        | `if a=4 then pln Всего хорошего!` | _Пока поддерживаются только выражения проверки на равенство переменных и числовых значений, а также только одна команда для выполнения._
| **Безусловный переход**            | `goto метка`        | Между `goto` и меткой допускается пробел или табуляция. Метка берётся без начальных и конечных пробелов и табуляции.
| **Очистка экрана**                 | `cls`               | **Не работает в режиме перенаправленного вывода.** _Пока не учитывает никаких настроек через переменные._
| **Удаление переменных**            | `perkill`

#### Прочее
| Элемент                            | Пример              | Заметка
| ---------------------------------- | ------------------- | -----------
| **Однострочный комментарий**       | `; Комментарий`     | Допускается в любой строке. Вырезается до загрузки квеста.
| **Многострочный комментарий**      | `/* Комментарий */` | Допускается в любом месте. Вырезается до загрузки квеста.

### Системные переменные
| Переменная     | Пример         | Заметка
| -------------- | -------------- | -----------
| `current_loc`  | `current_loc`  | Текущая локация (последняя метка, на которую перешли по кнопке).
| `previous_loc` | `previous_loc` | Предыдущая локация (метка, на которую перешли по кнопке в предыдущий раз).
| `rnd[число]`   | `rnd6`         | Возвращает случайное число. <br/> Если указано число - то целое число от 1 до указанного числа, иначе - дробное число от 0 до 1 не включая.

### Ограничения
- Подстановки `#$` пока поддерживаются только простые (имя переменной: `#a$`) внутри `p`/`pln`.
- `Common`-локации пока не поддерживаются.